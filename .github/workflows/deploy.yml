- name: Deploy to EC2
  run: |
    echo "$EC2_KEY" > key.pem          # create key file
    chmod 600 key.pem                  # secure permissions
    ssh -o StrictHostKeyChecking=no -i key.pem $EC2_USER@$EC2_HOST << 'EOF'
      cd $EC2_PATH

      echo "游리 Pulling latest..."
      git fetch --all
      git reset --hard origin/main

      echo "游리 Installing deps..."
      corepack enable
      yarn install --frozen-lockfile

      echo "游리 Building..."
      yarn build

      echo "游릭 Restarting PM2..."
      pm2 restart storefront || pm2 start "yarn start --port 8000" --name storefront
      pm2 save

      echo "游 Deployment complete!"
    EOF
